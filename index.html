<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Hệ Thống PDF Processor v2</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container main-container">
      <!-- Header với Session & Batch -->
      <div class="row align-items-center mb-4">
        <div class="col-md-6">
          <h3 class="fw-bold mb-1">
            <i class="fa-solid fa-microchip text-primary me-2"></i>PDF
            Auto-Parser
          </h3>
          <p class="text-muted small mb-0">
            Hệ thống bóc tách dữ liệu đa nền tảng
          </p>
        </div>
        <div class="col-md-6 d-flex justify-content-end gap-3">
          <div class="session-card">
            <div class="session-icon-wrapper">
              <i class="fa-solid fa-fingerprint"></i>
            </div>
            <div>
              <div class="session-label">
                <span class="pulse-dot me-1"></span>SESSION ID
              </div>
              <div class="session-value" id="displaySessionID">---</div>
            </div>
          </div>
          <div class="session-card">
            <div class="session-icon-wrapper text-info">
              <i class="fa-solid fa-layer-group"></i>
            </div>
            <div>
              <div class="session-label">BATCH ID</div>
              <div class="session-value text-primary" id="displayBatchID">
                ---
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Progress Bar -->
      <div id="progressContainer">
        <div class="d-flex justify-content-between mb-2">
          <span class="small fw-bold text-primary" id="progressText"
            >Sẵn sàng</span
          >
          <span class="small fw-bold text-primary" id="progressPercent"
            >0%</span
          >
        </div>
        <div class="progress">
          <div
            id="mainProgressBar"
            class="progress-bar progress-bar-striped progress-bar-animated bg-primary"
            style="width: 0%"
          ></div>
        </div>
      </div>

      <div class="row">
        <!-- Upload Side -->
        <div class="col-lg-4">
          <div class="card">
            <div class="card-header">Tải tệp PDF</div>
            <div class="card-body">
              <input
                type="file"
                id="fileInput"
                class="form-control mb-3"
                accept=".pdf"
                multiple
              />
              <div
                id="fileListDisplay"
                style="
                  max-height: 350px;
                  overflow-y: auto;
                  border: 1px solid #eee;
                  border-radius: 10px;
                  padding: 10px;
                "
              >
                <div class="text-center text-muted py-5 small">
                  Chưa chọn tệp
                </div>
              </div>
              <button
                class="btn btn-process w-100 mt-3"
                id="processBtn"
                disabled
              >
                <i class="fa-solid fa-play me-2"></i> BẮT ĐẦU XỬ LÝ
              </button>
            </div>
          </div>
        </div>

        <!-- Product Side -->
        <div class="col-lg-8">
          <div class="card">
            <div
              class="card-header d-flex justify-content-between align-items-center"
            >
              <span
                ><i class="fa-solid fa-boxes-stacked me-2"></i>Sản phẩm bóc
                tách</span
              >
              <span class="badge bg-primary rounded-pill" id="totalProductCount"
                >0 items</span
              >
            </div>
            <div class="card-body p-0">
              <div class="product-table-container">
                <table
                  class="table table-sm table-hover align-middle mb-0 table-products"
                >
                  <thead>
                    <tr>
                      <th class="ps-3">File nguồn</th>
                      <th>Mã Barcode</th>
                      <th>Tên sản phẩm</th>
                      <th class="text-center">ĐVT</th>
                      <th class="text-center">SL</th>
                      <th class="text-end pe-3">Đơn giá</th>
                    </tr>
                  </thead>
                  <tbody id="productSummaryBody">
                    <tr>
                      <td colspan="6" class="text-center py-5 text-muted">
                        Chưa có dữ liệu
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Detail Result Side -->
      <div class="row mt-2" id="detailTableArea" style="display: none">
        <div class="col-12">
          <div class="card">
            <div class="card-header bg-white">
              <i class="fa-solid fa-circle-check me-2"></i>Trạng thái ghi nhận
              đơn hàng
            </div>
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table table-bordered align-middle mb-0">
                  <thead class="table-dark">
                    <tr>
                      <th class="ps-3">Tên File</th>
                      <th>Hệ thống</th>
                      <th>Số PO</th>
                      <th class="text-end">Tổng tiền</th>
                      <th class="text-center">Kết quả Sheet</th>
                    </tr>
                  </thead>
                  <tbody id="detailLogBody"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Debug Area -->
      <div class="card border-warning mt-4">
        <div class="card-header bg-warning text-dark fw-bold small">
          PDF RAW DATA INDEX (DEBUG)
        </div>
        <div class="card-body"><div id="debugRawArea">Sẵn sàng...</div></div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="script.js"></script>
  </body>
</html>
